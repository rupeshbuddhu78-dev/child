package com.example.childapp;

import android.content.Context;
import org.webrtc.Camera2Enumerator;
import org.webrtc.CameraVideoCapturer;
import org.webrtc.SurfaceTextureHelper;
import org.webrtc.VideoCapturer;

public class MyCameraManager {
    private Context context;
    private CameraVideoCapturer cameraCapturer;

    public MyCameraManager(Context context) {
        this.context = context;
    }

    public VideoCapturer createCameraCapturer(SurfaceTextureHelper helper) {
        Camera2Enumerator enumerator = new Camera2Enumerator(context);
        final String[] deviceNames = enumerator.getDeviceNames();

        // 1. Pehle Front Camera Try karo
        for (String deviceName : deviceNames) {
            if (enumerator.isFrontFacing(deviceName)) {
                cameraCapturer = enumerator.createCapturer(deviceName, null);
                if (cameraCapturer != null) return cameraCapturer;
            }
        }

        // 2. Agar Front nahi mila to Back Camera lo
        for (String deviceName : deviceNames) {
            if (enumerator.isBackFacing(deviceName)) {
                cameraCapturer = enumerator.createCapturer(deviceName, null);
                if (cameraCapturer != null) return cameraCapturer;
            }
        }
        return null;
    }

    // Camera Switch karne ka function
    public void switchCamera() {
        if (cameraCapturer != null) {
            cameraCapturer.switchCamera(null);
        }
    }
    
    public void stop() {
        if(cameraCapturer != null) {
            try { cameraCapturer.stopCapture(); } catch(Exception e){}
            cameraCapturer.dispose();
        }
    }
}
