<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery Viewer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg: #0f0f0f; --cyan: #00f3ff; --glass: rgba(255,255,255,0.1); }
        body { background: var(--bg); color: white; font-family: sans-serif; padding: 20px; }
        .container { max-width: 450px; margin: auto; background: rgba(0,0,0,0.5); border-radius: 20px; padding: 15px; border: 1px solid #333; }
        .gallery-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 20px; }
        .img-card { aspect-ratio: 1/1; border-radius: 8px; overflow: hidden; border: 1px solid #444; position: relative; cursor: pointer; }
        .img-card img { width: 100%; height: 100%; object-fit: cover; }
        .load-btn { width: 100%; padding: 12px; margin-top: 20px; border-radius: 10px; border: none; background: var(--cyan); font-weight: bold; display: none; cursor: pointer; }
        .modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); display:none; align-items:center; justify-content:center; z-index:100; }
        .modal img { max-width: 90%; max-height: 80%; }
    </style>
</head>
<body>
    <div class="container">
        <div style="display:flex; justify-content: space-between; align-items: center;">
            <a href="index.html" style="color:white;"><i class="fa-solid fa-arrow-left"></i></a>
            <span style="color:var(--cyan)">GALLERY VIEWER</span>
            <i class="fa-solid fa-rotate" onclick="location.reload()"></i>
        </div>
        
        <div id="galleryContainer" class="gallery-grid"></div>
        <button id="loadMoreBtn" class="load-btn" onclick="renderNextBatch()">Load More</button>
    </div>

    <div class="modal" id="modal" onclick="this.style.display='none'"><img id="modalImg"></div>

    <script>
        const API_BASE = 'https://child-v9no.onrender.com';
        const urlParams = new URLSearchParams(window.location.search);
        const DEVICE_ID = urlParams.get('id');
        
        let allImages = [];
        let currentIndex = 0;

        async function fetchGallery() {
            if(!DEVICE_ID) return alert("No ID");
            const res = await fetch(`${API_BASE}/api/get-data/${DEVICE_ID}/gallery`);
            allImages = await res.json();
            renderNextBatch();
        }

        function renderNextBatch() {
            const container = document.getElementById('galleryContainer');
            const batch = allImages.slice(currentIndex, currentIndex + 5);
            
            batch.forEach(imgData => {
                const div = document.createElement('div');
                div.className = 'img-card';
                let src = imgData.image.startsWith('data') ? imgData.image : `data:image/jpeg;base64,${imgData.image}`;
                div.innerHTML = `<img src="${src}">`;
                div.onclick = () => {
                    document.getElementById('modalImg').src = src;
                    document.getElementById('modal').style.display = 'flex';
                };
                container.appendChild(div);
            });

            currentIndex += batch.length;
            document.getElementById('loadMoreBtn').style.display = currentIndex < allImages.length ? 'block' : 'none';
        }

        window.onload = fetchGallery;
    </script>
</body>
</html>
