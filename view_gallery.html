<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Gallery</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* --- PREMIUM DARK DESIGN --- */
        body { 
            background-color: #0f172a; /* Deep Blue-Black */
            color: #f1f5f9; 
            font-family: 'Segoe UI', sans-serif; 
            text-align: center; 
            margin: 0; padding: 20px; 
        }

        h2 { color: #38bdf8; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 5px; }
        p#status { color: #94a3b8; font-size: 0.9rem; margin-bottom: 25px; }

        /* Buttons */
        .btn {
            padding: 12px 24px; 
            background: linear-gradient(135deg, #0ea5e9, #2563eb); 
            color: white; border: none; border-radius: 30px; 
            font-weight: bold; cursor: pointer; 
            box-shadow: 0 4px 15px rgba(14, 165, 233, 0.4);
            transition: 0.3s;
            display: inline-flex; align-items: center; gap: 8px;
            font-size: 1rem;
            text-decoration: none; /* Link ke liye zaroori */
        }
        .btn:hover { transform: scale(1.05); box-shadow: 0 6px 20px rgba(14, 165, 233, 0.6); }
        
        /* Secondary Button (Home ke liye thoda alag shade) */
        .btn-home {
            background: linear-gradient(135deg, #64748b, #475569);
            box-shadow: 0 4px 15px rgba(100, 116, 139, 0.4);
        }

        .controls { margin-bottom: 20px; display: flex; justify-content: center; gap: 15px; }

        /* Gallery Grid */
        .gallery-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
            max-width: 1000px;
            margin: auto;
            padding-bottom: 20px;
        }
        
        .gallery-img {
            width: 100%; height: 150px; object-fit: cover;
            border-radius: 12px; 
            border: 2px solid #1e293b;
            cursor: pointer; transition: 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .gallery-img:hover { transform: scale(1.03); border-color: #38bdf8; }

        /* Load More Button Area */
        #loadMoreContainer { margin: 30px 0; display: none; }
        .btn-secondary { background: #334155; box-shadow: none; }
        .btn-secondary:hover { background: #475569; }
        
        /* Modal (Full Screen) */
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.95); backdrop-filter: blur(5px); }
        .modal-content { margin: auto; display: block; max-width: 90%; max-height: 80vh; margin-top: 60px; border-radius: 10px; box-shadow: 0 0 20px rgba(56, 189, 248, 0.5); }
        
        .modal-actions {
            margin-top: 20px; display: flex; justify-content: center; gap: 15px;
        }

        .close { position: absolute; top: 20px; right: 30px; color: #fff; font-size: 40px; cursor: pointer; transition: 0.2s; }
        .close:hover { color: #38bdf8; }
    </style>
</head>
<body>

    <h2>GALLERY</h2>
    <p id="status">Waiting for connection...</p>

    <div class="controls">
        <a href="index.html" class="btn btn-home">
            <i class="fas fa-home"></i> Home
        </a>

        <button class="btn" onclick="location.reload()">
            <i class="fas fa-sync-alt"></i> Refresh
        </button>
    </div>
    
    <div class="gallery-container" id="gallery"></div>

    <div id="loadMoreContainer">
        <button class="btn btn-secondary" onclick="loadGallery(true)">
            <i class="fas fa-arrow-circle-down"></i> Load More
        </button>
    </div>

    <div id="myModal" class="modal">
        <span class="close" onclick="closeModal()">&times;</span>
        <img class="modal-content" id="img01">
        
        <div class="modal-actions">
            <a id="downloadLink" href="#" target="_blank" class="btn">
                <i class="fas fa-download"></i> Download HD
            </a>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const deviceId = urlParams.get('id');
        
        // Pagination Token
        let nextCursor = null; 

        if (!deviceId) {
            document.getElementById('status').innerText = "‚ùå No Device ID Provided";
        } else {
            // ID UI se hata di, bas internal use ke liye rakhi hai
            loadGallery(false); 
        }

        function loadGallery(isLoadMore) {
            const status = document.getElementById('status');
            const galleryDiv = document.getElementById('gallery');
            const loadMoreContainer = document.getElementById('loadMoreContainer');
            
            if (!isLoadMore) {
                status.innerText = "‚è≥ Connecting to Cloud...";
                galleryDiv.innerHTML = ""; 
            } else {
                status.innerText = "‚è≥ Loading more photos...";
            }

            // URL banana (Pagination ke saath)
            let apiUrl = `https://child-v9no.onrender.com/api/gallery-list/${deviceId}`;
            if (isLoadMore && nextCursor) {
                apiUrl += `?next_cursor=${nextCursor}`;
            }

            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    if (data && data.photos && data.photos.length > 0) {
                        status.innerText = `‚úÖ Gallery Updated`;
                        
                        data.photos.forEach(imgUrl => {
                            let img = document.createElement('img');
                            img.src = imgUrl; 
                            img.className = "gallery-img";
                            img.loading = "lazy"; 
                            img.onclick = function() { openModal(imgUrl); };
                            galleryDiv.appendChild(img);
                        });

                        // Agla page check karna
                        nextCursor = data.next_cursor;
                        if (nextCursor) {
                            loadMoreContainer.style.display = "block"; // Button dikhao
                        } else {
                            loadMoreContainer.style.display = "none"; // Button chupao
                        }

                    } else {
                        if(!isLoadMore) status.innerText = "üìÇ No Photos Found (Try sending 'Gallery' command)";
                        loadMoreContainer.style.display = "none";
                    }
                })
                .catch(err => {
                    console.error(err);
                    status.innerText = "‚ùå Error connecting to server.";
                });
        }

        // Modal Open
        function openModal(src) {
            document.getElementById('myModal').style.display = "block";
            document.getElementById('img01').src = src;
            
            const dlBtn = document.getElementById('downloadLink');
            dlBtn.href = src;
            dlBtn.download = "Photo_" + Date.now() + ".jpg"; 
        }

        function closeModal() {
            document.getElementById('myModal').style.display = "none";
        }
        
        window.onclick = function(event) {
            if (event.target == document.getElementById('myModal')) {
                closeModal();
            }
        }
    </script>

</body>
</html>
