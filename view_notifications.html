<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Notification Log</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-color: #000000;
            --card-bg: #111;
            --border: #222;
            --text-main: #eee;
            --text-sub: #888;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            justify-content: center;
            overflow: hidden;
        }

        .container {
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            border-left: 1px solid var(--border);
            border-right: 1px solid var(--border);
            position: relative;
        }

        /* --- Header --- */
        .header {
            padding: 20px;
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        .header h2 { font-size: 20px; display: flex; align-items: center; gap: 10px; }
        .badge-count { background: #e91e63; color: white; font-size: 12px; padding: 2px 8px; border-radius: 10px; }

        /* --- List Area --- */
        .log-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .log-list::-webkit-scrollbar { width: 4px; }
        .log-list::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }

        /* --- Notification Card --- */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 15px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            animation: slideIn 0.3s ease-out;
            transition: background 0.2s;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Icon Box */
        .app-icon {
            width: 45px; height: 45px;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            flex-shrink: 0;
            background: #222; /* Default fallback */
            color: #fff;
        }

        /* Text Content */
        .content { flex: 1; overflow: hidden; }
        
        .row-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
        .app-name { font-size: 11px; text-transform: uppercase; font-weight: bold; letter-spacing: 0.5px; color: #666; }
        .time { font-size: 11px; color: #555; }

        .title { font-size: 15px; font-weight: 700; color: #fff; margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .msg-text { font-size: 14px; color: #aaa; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }

        /* Loading State */
        .empty-state { text-align: center; color: #444; margin-top: 50px; font-size: 14px; }
        .loader { color: #4caf50; font-size: 20px; margin-bottom: 10px; }

    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h2>
                <i class="fas fa-bell"></i> Notifications
                <span class="badge-count" id="countBadge">0</span>
            </h2>
            <i class="fas fa-sync-alt" style="cursor:pointer; color:#666;" onclick="fetchData()"></i>
        </div>

        <div class="log-list" id="logContainer">
            <div class="empty-state">
                <i class="fas fa-satellite-dish loader fa-spin"></i><br>
                Waiting for notifications...
            </div>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const deviceId = urlParams.get('id');
        const API_URL = `https://child-v9no.onrender.com/api/get-data/${deviceId}/notifications`;

        // --- 1. THE BIG APP MAP (Icon & Color Logic) ---
        // Yahan define hai ki kis app ka icon aur color kaisa dikhega
        const appMap = [
            // Social & Chat
            { keys: ['whatsapp'], icon: 'fa-whatsapp', color: '#25D366', bg: 'rgba(37, 211, 102, 0.1)' },
            { keys: ['instagram'], icon: 'fa-instagram', color: '#E1306C', bg: 'rgba(225, 48, 108, 0.1)' },
            { keys: ['facebook', 'fb'], icon: 'fa-facebook-f', color: '#1877F2', bg: 'rgba(24, 119, 242, 0.1)' },
            { keys: ['snapchat'], icon: 'fa-snapchat', color: '#FFFC00', bg: 'rgba(255, 252, 0, 0.1)' },
            { keys: ['telegram'], icon: 'fa-telegram', color: '#0088cc', bg: 'rgba(0, 136, 204, 0.1)' },
            { keys: ['messenger'], icon: 'fa-facebook-messenger', color: '#00B2FF', bg: 'rgba(0, 178, 255, 0.1)' },
            { keys: ['sms', 'message', 'messaging'], icon: 'fa-comment-alt', color: '#4caf50', bg: 'rgba(76, 175, 80, 0.1)' },
            
            // AI
            { keys: ['gemini', 'google'], icon: 'fa-google', color: '#4285F4', bg: 'rgba(66, 133, 244, 0.1)' },
            { keys: ['chatgpt', 'openai'], icon: 'fa-robot', color: '#10a37f', bg: 'rgba(16, 163, 127, 0.1)' },

            // Payments (Wallet Icon)
            { keys: ['gpay', 'google pay', 'wallet'], icon: 'fa-google-pay', color: '#fff', bg: '#4285F4' },
            { keys: ['phonepe', 'paytm', 'navi', 'bhim', 'upi'], icon: 'fa-rupee-sign', color: '#673ab7', bg: 'rgba(103, 58, 183, 0.1)' },

            // Shopping (Cart Icon)
            { keys: ['blinkit', 'amazon', 'flipkart', 'jiomart', 'myntra', 'ajio', 'shopsy'], icon: 'fa-shopping-bag', color: '#ff9800', bg: 'rgba(255, 152, 0, 0.1)' },

            // Travel & Maps (Location/Taxi Icon)
            { keys: ['uber', 'ola', 'rapido', 'taxi'], icon: 'fa-taxi', color: '#fff', bg: '#000' },
            { keys: ['map', 'gps', 'navigation'], icon: 'fa-map-marked-alt', color: '#34a853', bg: 'rgba(52, 168, 83, 0.1)' },
            { keys: ['irctc', 'ixigo', 'train', 'rail'], icon: 'fa-train', color: '#2196f3', bg: 'rgba(33, 150, 243, 0.1)' },

            // Entertainment
            { keys: ['spotify', 'music', 'audio'], icon: 'fa-spotify', color: '#1db954', bg: 'rgba(29, 185, 84, 0.1)' },
            { keys: ['youtube', 'video', 'mx player', 'hotstar', 'netflix', 'prime'], icon: 'fa-play', color: '#f44336', bg: 'rgba(244, 67, 54, 0.1)' },

            // System & Utilities
            { keys: ['phone', 'call', 'dialer'], icon: 'fa-phone-alt', color: '#00e676', bg: 'rgba(0, 230, 118, 0.1)' },
            { keys: ['mail', 'gmail', 'outlook'], icon: 'fa-envelope', color: '#ea4335', bg: 'rgba(234, 67, 53, 0.1)' },
            { keys: ['chrome', 'browser'], icon: 'fa-chrome', color: '#fbbc05', bg: 'rgba(251, 188, 5, 0.1)' },
            { keys: ['setting', 'config'], icon: 'fa-cog', color: '#9e9e9e', bg: 'rgba(158, 158, 158, 0.1)' },
            { keys: ['photo', 'gallery'], icon: 'fa-images', color: '#ff4081', bg: 'rgba(255, 64, 129, 0.1)' }
        ];

        // --- 2. Helper to Find Icon ---
        function getStyle(appName, pkgName) {
            const searchText = (appName + " " + pkgName).toLowerCase();
            
            for (let item of appMap) {
                if (item.keys.some(k => searchText.includes(k))) {
                    return item;
                }
            }
            // Fallback (Agar kuch match na ho)
            return { icon: 'fa-bell', color: '#fff', bg: '#333' };
        }

        // --- 3. Render List ---
        async function fetchData() {
            if (!deviceId) return;
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                
                // Sort: Newest First
                data.sort((a, b) => b.postTime - a.postTime);

                const container = document.getElementById('logContainer');
                document.getElementById('countBadge').innerText = data.length;

                if(data.length === 0) {
                    container.innerHTML = `<div class="empty-state">No notifications yet</div>`;
                    return;
                }

                // Poora list wapas banate hain
                let html = "";
                
                data.forEach(item => {
                    // Logic to find details
                    const style = getStyle(item.appName || "", item.packageName || "");
                    const timeStr = new Date(parseInt(item.postTime)).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    
                    html += `
                        <div class="card">
                            <div class="app-icon" style="color: ${style.color}; background: ${style.bg}; border: 1px solid ${style.color}40;">
                                <i class="${style.icon}"></i> </div>
                            <div class="content">
                                <div class="row-top">
                                    <span class="app-name" style="color:${style.color}">${item.appName || "SYSTEM"}</span>
                                    <span class="time">${timeStr}</span>
                                </div>
                                <div class="title">${item.title || "Notification"}</div>
                                <div class="msg-text">${item.text || "Tap to view details"}</div>
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;

            } catch (error) {
                console.error("Error fetching logs:", error);
            }
        }

        // Auto Refresh every 3 seconds
        fetchData();
        setInterval(fetchData, 3000);

    </script>
</body>
</html>
